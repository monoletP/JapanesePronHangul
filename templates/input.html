<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가사 입력 - 일본어 가사 한글 변환기</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>가사 입력</h1>
            <button onclick="goBack()" class="back-button">← 뒤로</button>
        </header>

        <main>
            <div class="input-panel">
                <label for="inputText">
                    <h2>일본어 가사를 입력하세요</h2>
                </label>
                <textarea 
                    id="inputText" 
                    placeholder="여러 줄의 일본어 가사를 입력하세요...&#10;예시:&#10;息を繋ぐ僕らの声は何を望む&#10;深い海の底で響く鼓動"
                    rows="15"
                ></textarea>
                
                <div class="char-count">
                    <span id="charCount">0</span> 글자
                </div>
            </div>

            <div class="action-buttons">
                <button onclick="convertText()" class="primary-button" id="convertButton">
                    변환하기
                </button>
            </div>

            <div id="loadingMessage" class="loading" style="display: none;">
                변환 중입니다...
            </div>
        </main>
    </div>

    <script>
        const inputText = document.getElementById('inputText');
        const charCount = document.getElementById('charCount');
        const convertButton = document.getElementById('convertButton');
        const loadingMessage = document.getElementById('loadingMessage');

        // 글자 수 카운트
        inputText.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });

        function goBack() {
            window.location.href = '/';
        }

        async function convertText() {
            const text = inputText.value.trim();
            
            if (!text) {
                alert('텍스트를 입력해주세요.');
                return;
            }

            const detailMode = sessionStorage.getItem('detailMode') === 'true';

            // UI 업데이트
            convertButton.disabled = true;
            loadingMessage.style.display = 'block';

            try {
                const response = await fetch('/api/convert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        detail_mode: detailMode
                    })
                });

                const data = await response.json();
                
                // 결과를 세션에 저장
                sessionStorage.setItem('convertedData', JSON.stringify(data));
                
                // 상세 모드 여부에 따라 페이지 이동
                if (detailMode) {
                    window.location.href = '/edit';
                } else {
                    window.location.href = '/output';
                }
            } catch (error) {
                console.error('변환 오류:', error);
                alert('변환 중 오류가 발생했습니다.');
                convertButton.disabled = false;
                loadingMessage.style.display = 'none';
            }
        }

        // Enter 키로 변환 (Ctrl+Enter)
        inputText.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                convertText();
            }
        });
    </script>
</body>
</html>
